You are a senior full stack engineer. The Noor CBT app already works. Your job now is to add Stripe subscriptions in the cleanest MVP way possible without breaking the existing reflection flow.

Goal
Add a paid plan that unlocks the full experience. Keep a simple free experience.

Business rules
Free user can complete 1 reflection per day and view only the last 3 past reflections
Paid user can complete unlimited reflections and view full history

Plan
One subscription plan to start
Name: Noor Plus
Price: 9.99 per month
Support upgrade and cancel

Tech requirements
Use Stripe Checkout for subscription creation and Stripe Customer Portal for manage billing. Do not build a custom card form.

Stack assumptions
React frontend and Node backend exist.

Implementation steps

Stripe setup in code
Add Stripe secret key in server env
STRIPE_SECRET_KEY
Add client env for publishable key
VITE_STRIPE_PUBLISHABLE_KEY

Data model changes
Add user billing fields to existing user record
stripeCustomerId
stripeSubscriptionId
subscriptionStatus
currentPeriodEnd

Backend endpoints
Create these server routes

POST api billing create checkout session
Input: priceId
Output: checkoutUrl
Create or reuse Stripe customer tied to the logged in user
Create Stripe Checkout Session in subscription mode
Success URL returns to app route billing success
Cancel URL returns to app route billing cancel

POST api billing create portal session
Output: portalUrl
Create Stripe Billing Portal session for customer

POST api billing webhook
Verify Stripe signature using STRIPE_WEBHOOK_SECRET
Handle events
checkout session completed
customer subscription created
customer subscription updated
customer subscription deleted
Update the user record subscriptionStatus and currentPeriodEnd

GET api billing status
Return current subscriptionStatus and plan name

Frontend changes
Add a Pricing page with 2 cards
Free
Plus

Add Upgrade button that calls create checkout session and redirects to checkoutUrl

Add Manage Billing button visible only for paid users that calls create portal session and redirects to portalUrl

Add a small lock indicator on features that exceed free limits
Disable or block with a modal that routes to Pricing

Access control
Enforce free limits on the server, not only in UI
Before saving a reflection or retrieving history, check subscriptionStatus
If free and limit exceeded, return 402 with message Upgrade to Noor Plus for unlimited reflections

Stripe configuration
Use Stripe test mode
Create one product and one recurring price
Store PRICE_ID in env as STRIPE_PRICE_ID

Deliverables
Working subscription upgrade flow
Working manage billing portal
Webhook updates user subscription status correctly
Free limits enforced server side
No breaking changes to reflection journey

Make code clean
Put all billing logic in a billing module
Do not scatter Stripe calls across unrelated files
Add concise comments and a short README section describing setup steps and local testing