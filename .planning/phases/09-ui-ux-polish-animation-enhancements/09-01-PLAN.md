---
phase: 09-ui-ux-polish-animation-enhancements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - client/components/AnimatedInput.tsx
  - client/components/__tests__/AnimatedInput.test.tsx
autonomous: true

must_haves:
  truths:
    - "Input fields glow smoothly when focused"
    - "Character count fades in with spring physics when typing begins"
    - "Error states trigger gentle shake animation"
  artifacts:
    - path: "client/components/AnimatedInput.tsx"
      provides: "AnimatedInput component with focus glow, character count, error shake"
      min_lines: 100
      exports: ["AnimatedInput"]
    - path: "client/components/__tests__/AnimatedInput.test.tsx"
      provides: "Unit tests for AnimatedInput behavior"
      min_lines: 50
  key_links:
    - from: "client/components/AnimatedInput.tsx"
      to: "client/constants/theme.ts"
      via: "imports Spacing, BorderRadius, Typography"
      pattern: "import.*from.*@/constants/theme"
    - from: "client/components/AnimatedInput.tsx"
      to: "react-native-reanimated"
      via: "uses withSpring, useSharedValue, useAnimatedStyle"
      pattern: "withSpring.*springConfig"
---

<objective>
Create AnimatedInput component with premium input field animations

Purpose: Transform standard TextInput into premium quality with focus glow, character count animation, and error shake - matching the polish level of Button.tsx and GlassCard.tsx

Output: AnimatedInput.tsx component with tests, ready for integration into ThoughtCaptureScreen and other input-heavy screens
</objective>

<execution_context>
@C:\Users\richa\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\richa\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-ui-ux-polish-animation-enhancements/09-RESEARCH.md
@client/components/Button.tsx
@client/components/GlassCard.tsx
@client/constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnimatedInput component with focus glow animation (UX-01)</name>
  <files>client/components/AnimatedInput.tsx</files>
  <action>
Create AnimatedInput.tsx following Button.tsx patterns:

1. Import dependencies:
   - react-native-reanimated: useAnimatedStyle, useSharedValue, withSpring, withTiming
   - theme.ts: Spacing, BorderRadius, Typography
   - useTheme hook

2. Define interface AnimatedInputProps:
   - placeholder?: string
   - value: string
   - onChangeText: (text: string) => void
   - maxLength?: number (default 1000)
   - showCharCount?: boolean (default true)
   - error?: boolean (for shake animation trigger)
   - onFocus?: () => void
   - onBlur?: () => void
   - multiline?: boolean (default true)
   - accessibilityLabel?: string
   - accessibilityHint?: string

3. Use the EXACT springConfig from Button.tsx:
   ```typescript
   const springConfig: WithSpringConfig = {
     damping: 20,
     mass: 0.5,
     stiffness: 120,
     overshootClamping: true,
     energyThreshold: 0.001,
   };
   ```

4. Implement focus glow using shared values:
   - glowOpacity: useSharedValue(0)
   - On focus: withSpring(1, springConfig)
   - On blur: withSpring(0, springConfig)

5. Apply glow via useAnimatedStyle:
   - borderColor interpolates from theme.border to theme.primary
   - shadowColor: theme.primary
   - shadowOpacity: glowOpacity.value * 0.3
   - shadowRadius: 8
   - elevation: glowOpacity.value * 4

6. Wrap TextInput in Animated.View with glowStyle
  </action>
  <verify>
- File exists at client/components/AnimatedInput.tsx
- TypeScript compiles: `npx tsc --noEmit`
- Import resolves: grep "AnimatedInput" in component
  </verify>
  <done>AnimatedInput renders with smooth focus glow animation using contemplative spring physics</done>
</task>

<task type="auto">
  <name>Task 2: Add character count fade-in with spring physics (UX-02)</name>
  <files>client/components/AnimatedInput.tsx</files>
  <action>
Extend AnimatedInput with character count animation:

1. Add shared value for character count visibility:
   ```typescript
   const charCountOpacity = useSharedValue(0);
   const charCountScale = useSharedValue(0.8);
   ```

2. Create charCountStyle using useAnimatedStyle:
   ```typescript
   const charCountStyle = useAnimatedStyle(() => ({
     opacity: charCountOpacity.value,
     transform: [{ scale: charCountScale.value }],
   }));
   ```

3. Update animation on text change (in onChangeText handler or effect):
   - When value.length changes from 0 to >0: animate in
     - charCountOpacity: withSpring(1, springConfig)
     - charCountScale: withSpring(1, springConfig)
   - When value.length changes to 0: animate out
     - charCountOpacity: withSpring(0, springConfig)
     - charCountScale: withSpring(0.8, springConfig)

4. Render character count below input:
   ```tsx
   {showCharCount && (
     <Animated.View style={[styles.charCountContainer, charCountStyle]}>
       <ThemedText type="caption" style={{ color: theme.textSecondary }}>
         {value.length} / {maxLength}
       </ThemedText>
     </Animated.View>
   )}
   ```

5. Add styles:
   ```typescript
   charCountContainer: {
     alignItems: 'flex-end',
     marginTop: Spacing.xs,
     paddingHorizontal: Spacing.sm,
   }
   ```
  </action>
  <verify>
- Character count appears with spring animation when typing begins
- Character count fades out when input is cleared
- Animation uses same springConfig as focus glow (contemplative feel)
  </verify>
  <done>Character count fades in smoothly with spring physics when user starts typing</done>
</task>

<task type="auto">
  <name>Task 3: Add error state shake animation and tests (UX-03)</name>
  <files>client/components/AnimatedInput.tsx, client/components/__tests__/AnimatedInput.test.tsx</files>
  <action>
Add error shake animation to AnimatedInput:

1. Add shared value for shake:
   ```typescript
   const shakeOffset = useSharedValue(0);
   ```

2. Create shake animation function using withSequence:
   ```typescript
   const triggerShake = () => {
     shakeOffset.value = withSequence(
       withTiming(-8, { duration: 50 }),
       withTiming(8, { duration: 50 }),
       withTiming(-6, { duration: 50 }),
       withTiming(6, { duration: 50 }),
       withTiming(-4, { duration: 50 }),
       withTiming(4, { duration: 50 }),
       withTiming(0, { duration: 50 })
     );
   };
   ```

3. Add effect to trigger shake when error prop changes to true:
   ```typescript
   useEffect(() => {
     if (error) {
       triggerShake();
     }
   }, [error]);
   ```

4. Add shakeOffset to the wrapper transform:
   ```typescript
   const wrapperStyle = useAnimatedStyle(() => ({
     transform: [{ translateX: shakeOffset.value }],
   }));
   ```

5. Apply error border color when error=true:
   - borderColor: error ? theme.error : (glow interpolation)

Create tests in __tests__/AnimatedInput.test.tsx:

```typescript
import React from 'react';
import { render, fireEvent } from '@testing-library/react-native';
import { AnimatedInput } from '../AnimatedInput';

// Mock reanimated
jest.mock('react-native-reanimated', () => require('react-native-reanimated/mock'));

describe('AnimatedInput', () => {
  it('renders with placeholder', () => {
    const { getByPlaceholderText } = render(
      <AnimatedInput
        placeholder="Enter thought"
        value=""
        onChangeText={() => {}}
      />
    );
    expect(getByPlaceholderText('Enter thought')).toBeTruthy();
  });

  it('shows character count when typing', () => {
    const { getByText, rerender } = render(
      <AnimatedInput value="Hello" onChangeText={() => {}} maxLength={100} />
    );
    expect(getByText('5 / 100')).toBeTruthy();
  });

  it('calls onChangeText when text changes', () => {
    const onChangeText = jest.fn();
    const { getByPlaceholderText } = render(
      <AnimatedInput
        placeholder="Type here"
        value=""
        onChangeText={onChangeText}
      />
    );
    fireEvent.changeText(getByPlaceholderText('Type here'), 'new text');
    expect(onChangeText).toHaveBeenCalledWith('new text');
  });

  it('applies accessibility props', () => {
    const { getByLabelText } = render(
      <AnimatedInput
        value=""
        onChangeText={() => {}}
        accessibilityLabel="Thought input"
      />
    );
    expect(getByLabelText('Thought input')).toBeTruthy();
  });
});
```
  </action>
  <verify>
- Error prop triggers horizontal shake animation
- Tests pass: `npm run test:mobile -- AnimatedInput`
- TypeScript compiles without errors
  </verify>
  <done>Error states trigger gentle shake animation; component has unit tests for core behaviors</done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `npx tsc --noEmit`
2. AnimatedInput tests pass: `npm run test:mobile -- AnimatedInput`
3. Component exports AnimatedInput function
4. Animation uses springConfig with damping:20, mass:0.5, stiffness:120
5. Character count uses spring physics (not timing) for fade-in
6. Error shake uses translateX (not marginLeft) for performance
</verification>

<success_criteria>
1. AnimatedInput.tsx exists with focus glow, character count, and error shake
2. All animations use contemplative springConfig (matches Button.tsx)
3. Character count fades in/out with spring physics
4. Error shake animates horizontal offset without layout recalculation
5. Unit tests cover render, character count display, and accessibility
6. Zero TypeScript errors
7. All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/09-ui-ux-polish-animation-enhancements/09-01-SUMMARY.md`
</output>
