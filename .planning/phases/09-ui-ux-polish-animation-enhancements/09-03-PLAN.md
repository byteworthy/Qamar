---
phase: 09-ui-ux-polish-animation-enhancements
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - client/screens/HistoryScreen.tsx
autonomous: true

must_haves:
  truths:
    - "History list items animate in with staggered FadeInUp effect"
    - "Long-pressing list items provides tactile scale feedback"
    - "Animations maintain 60fps performance"
  artifacts:
    - path: "client/screens/HistoryScreen.tsx"
      provides: "Staggered list animations and long-press scale feedback"
      contains: "FadeInUp.springify"
  key_links:
    - from: "client/screens/HistoryScreen.tsx"
      to: "react-native-reanimated"
      via: "FadeInUp entering animation with .delay()"
      pattern: "FadeInUp\\.springify\\(\\)\\.delay"
    - from: "client/screens/HistoryScreen.tsx"
      to: "react-native-gesture-handler"
      via: "Gesture.LongPress for scale feedback"
      pattern: "Gesture\\.LongPress|LongPressGestureHandler"
---

<objective>
Add staggered entrance animations and long-press feedback to HistoryScreen list

Purpose: Elevate HistoryScreen polish to match HomeScreen quality - list items fade in with staggered timing, and long-press provides tactile feedback before actions

Output: Enhanced HistoryScreen.tsx with declarative reanimated animations for list items
</objective>

<execution_context>
@C:\Users\richa\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\richa\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-ui-ux-polish-animation-enhancements/09-RESEARCH.md
@client/screens/HistoryScreen.tsx
@client/components/GlassCard.tsx
@client/components/Button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add staggered FadeInUp animations to list items (UX-06)</name>
  <files>client/screens/HistoryScreen.tsx</files>
  <action>
Add staggered entrance animations to HistoryScreen list items:

1. Ensure Animated imports at top of file (some already exist):
   ```typescript
   import Animated, {
     FadeInUp,
     FadeInDown,
     FadeIn,
     FadeOut,
     useAnimatedStyle,
     useSharedValue,
     withSpring,
     WithSpringConfig,
   } from "react-native-reanimated";
   ```

2. Define springConfig constant (same as Button.tsx/GlassCard.tsx) at module level:
   ```typescript
   const springConfig: WithSpringConfig = {
     damping: 20,
     mass: 0.5,
     stiffness: 120,
     overshootClamping: true,
     energyThreshold: 0.001,
   };
   ```

3. Locate the renderItem function in FlatList. Wrap the list item content with Animated.View:
   ```typescript
   const renderItem = ({ item, index }: { item: Session; index: number }) => (
     <Animated.View
       entering={FadeInUp.springify()
         .delay(index * 40)  // 40ms stagger between items
         .damping(springConfig.damping)
         .mass(springConfig.mass)
         .stiffness(springConfig.stiffness)}
       exiting={FadeOut.duration(200)}
     >
       {/* Existing list item content - GlassCard or Pressable */}
     </Animated.View>
   );
   ```

4. Cap the delay to prevent excessive waits for long lists:
   ```typescript
   const cappedDelay = Math.min(index * 40, 400); // Max 400ms (10 items)
   ```

5. Add key prop to ensure animations replay correctly on list updates:
   - Use item.id or item.timestamp as unique key

NOTE: HistoryScreen already imports FadeInUp, FadeInDown, FadeIn. Extend usage to apply stagger pattern to list items.
  </action>
  <verify>
- List items animate in with staggered timing on screen focus
- Animation respects contemplative spring config
- No performance degradation (check FPS in dev tools if possible)
- Existing list functionality preserved (tap, expand, delete)
  </verify>
  <done>List items enter with staggered FadeInUp animation using 40ms delay between items</done>
</task>

<task type="auto">
  <name>Task 2: Implement long-press scale feedback on list items (UX-07)</name>
  <files>client/screens/HistoryScreen.tsx</files>
  <action>
Add long-press scale feedback to list items:

1. Create a separate animated list item component within the file or extract to a helper:
   ```typescript
   interface AnimatedHistoryItemProps {
     item: Session;
     index: number;
     onPress: () => void;
     onLongPress: () => void;
     expanded: boolean;
     theme: ReturnType<typeof useTheme>['theme'];
   }

   function AnimatedHistoryItem({
     item,
     index,
     onPress,
     onLongPress,
     expanded,
     theme,
   }: AnimatedHistoryItemProps) {
     const scale = useSharedValue(1);
     const cappedDelay = Math.min(index * 40, 400);

     const handlePressIn = () => {
       scale.value = withSpring(0.98, springConfig);
     };

     const handlePressOut = () => {
       scale.value = withSpring(1, springConfig);
     };

     const scaleStyle = useAnimatedStyle(() => ({
       transform: [{ scale: scale.value }],
     }));

     return (
       <Animated.View
         entering={FadeInUp.springify()
           .delay(cappedDelay)
           .damping(springConfig.damping)
           .mass(springConfig.mass)
           .stiffness(springConfig.stiffness)}
         exiting={FadeOut.duration(200)}
         style={scaleStyle}
       >
         <Pressable
           onPress={onPress}
           onLongPress={onLongPress}
           onPressIn={handlePressIn}
           onPressOut={handlePressOut}
           delayLongPress={500}
         >
           {/* Existing GlassCard content */}
         </Pressable>
       </Animated.View>
     );
   }
   ```

2. Update renderItem to use AnimatedHistoryItem:
   ```typescript
   const renderItem = ({ item, index }: { item: Session; index: number }) => (
     <AnimatedHistoryItem
       item={item}
       index={index}
       onPress={() => setExpandedId(expandedId === item.id ? null : item.id)}
       onLongPress={() => handleDeleteReflection(item.id)}
       expanded={expandedId === item.id}
       theme={theme}
     />
   );
   ```

3. Add haptic feedback on long press (already imported as hapticMedium):
   ```typescript
   const handleLongPress = () => {
     hapticMedium();
     handleDeleteReflection(item.id);
   };
   ```

4. Ensure scale animation uses transform (not width/margin) for 60fps performance:
   - transform: [{ scale: scale.value }] is correct
   - Do NOT use width, height, margin animations

NOTE: The existing HistoryScreen has a complex item render. Wrap the existing Pressable/GlassCard structure rather than replacing it entirely.
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit`
- Code contains scale shared value: `grep -q "useSharedValue(1)" client/screens/HistoryScreen.tsx`
- Code contains scale animation: `grep -q "withSpring(0.98" client/screens/HistoryScreen.tsx`
- Existing tests pass: `npm run test:mobile -- HistoryScreen` (if tests exist)
- Manual verification required: Long-press on device/simulator should scale item to 0.98 with spring physics, haptic fires on long press, scale returns to 1 on release
  </verify>
  <done>Long-press provides 0.98 scale feedback with haptic, matching Button.tsx interaction pattern</done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `npx tsc --noEmit`
2. HistoryScreen renders without errors
3. List items animate in with staggered timing
4. Long-press triggers scale animation + haptic
5. Animation respects springConfig (damping:20, mass:0.5, stiffness:120)
6. Existing tests pass: `npm run test:mobile -- HistoryScreen`
7. Performance: animations maintain ~60fps (visual check)
</verification>

<success_criteria>
1. FadeInUp.springify() with .delay(index * 40) applied to list items
2. Delay capped at 400ms to prevent slow renders on long lists
3. Long-press scales item to 0.98 with spring physics
4. Haptic feedback fires on long press
5. Scale uses transform (not layout properties)
6. Zero TypeScript errors
7. Existing functionality preserved (tap, expand, delete, export)
</success_criteria>

<output>
After completion, create `.planning/phases/09-ui-ux-polish-animation-enhancements/09-03-SUMMARY.md`
</output>
